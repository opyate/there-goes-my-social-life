# target/scala_2.8.1/bopango-website_2.8.1-0.1-SNAPSHOT.war

desc "An example command from the Capistrano wiki. Use with -s version=1.2.3"
task :testy, :hosts => "root@bopango.net" do
  run "date"
  run "echo $!"
#  run "ls -lart /root/bopango-deployments"
#  run "echo \"You're about to install version #{version} \""
#  run "export APPLE=apple"
#  run "echo \"You set env var $APPLE\""
end

# TODO link latest WAR file to /root/latest.war and use that below.
desc "Deploys to bopango staging. Use with -s version=1.2.3"
task :deploy, :hosts => "root@bopango.net" do
  run "service tomcat6 stop"
  run "rm -rf /var/lib/tomcat6/webapps/bopango/"
  run "rm -rf /var/lib/tomcat6/webapps/bopango.war"
  run "rm -rf /var/lib/tomcat6/webapps/../temp/*"
  run "rm -rf /var/lib/tomcat6/webapps/../work/*"
  run "cp ~/bopango-deployments/bopango-v#{version}.war /var/lib/tomcat6/webapps/bopango.war"
  run "service tomcat6 start"
  run "sleep 10"
  run "tail -n10 /var/log/tomcat6/catalina.out"
end

desc "Tail bopango.net Tomcat log. Should see, e.g. 'INFO: Server startup in 8734 ms'"
task :tail, :hosts => "root@bopango.net" do
  run "tail -n1 /var/log/tomcat6/catalina.out"
end

desc "Install base dependencies"
task :base, :hosts => "root@bopango.net" do
  run "yum install -y java"
  run "yum install -y git"
end
